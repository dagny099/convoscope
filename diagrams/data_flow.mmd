%% End-to-End Data Flow Diagram (Convoscope)

flowchart TD
    A[🧑‍💻 User Input] --> B[🔎 Input Validation]
    B --> |Valid| C[🧠 Session State Check]
    B --> |Invalid| D[❌ User-Friendly Error]

    C --> E[🤖 LLM Router]
    E --> F{Provider Available?}

    F --> |OpenAI| G[🔥 OpenAI API]
    F --> |OpenAI Failed| H[🧠 Anthropic Fallback]
    F --> |All Failed| I[🚨 Error Handler]

    G --> J[🧵 Response Processing]
    H --> J
    I --> K[❗ User Error Message]

    J --> L[🔊 Stream to UI]
    J --> M[💾 Save to Conversation Manager]

    M --> N[📁 File Storage]
    M --> O[🛟 Auto-save Backup]

    L --> P[📺 Display to User]
    N --> Q[🗂️ Conversation History]
    O --> R[🧯 Recovery System]

    style A fill:#e1f5fe
    style P fill:#e8f5e8
    style K fill:#ffebee
    style I fill:#ffebee
